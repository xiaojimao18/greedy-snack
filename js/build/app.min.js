/*! greedy-snack 1.0.0 2015-08-13 */
function Snack(){this.snackLen=5,this.direction=1,this.track=[],this.head=null,this.changeDir=!0;for(var a=0;a<this.snackLen;a++)config.context.fillStyle="#333",config.context.fillRect(a*config.getSize(),0,config.getSize(),config.getSize()),this.track.push({x:a,y:0});this.head={x:a-1,y:0}}function Food(a,b){var c=config.getSize();this.score=a||1,this.time=b||-1,this.x=Math.floor(Math.random()*config.getWidth()),this.y=Math.floor(Math.random()*config.getHeight()),config.context.fillStyle="#3f51b5",config.context.fillRect(this.x*c,this.y*c,c,c)}!function(){var a={},b=30,c=30,d=1,e=10;a.init=function(){var a=document.getElementById("game-zone");return a.getContext?void(this.context=a.getContext("2d")):void alert("您的浏览器版本太低，请您使用更高级的浏览器来运行")},a.speedup=function(){5>d&&d++},a.speeddown=function(){d>1&&d--},a.getSpeed=function(){return d},a.getWidth=function(){return b},a.getHeight=function(){return c},a.getSize=function(){return e},a.resetSpeed=function(){d=1},window.config=a}(),!function(){function a(a){if(null!==f&&f.changeDir)switch(f.changeDir=!1,a.keyCode){case 38:2!=f.direction&&(f.direction=0);break;case 39:3!=f.direction&&(f.direction=1);break;case 40:0!=f.direction&&(f.direction=2);break;case 37:1!=f.direction&&(f.direction=3)}}function b(a){a.preventDefault(),null==n?(l=a.targetTouches[0].pageX,m=a.targetTouches[0].pageY):clearTimeout(n),n=setTimeout(function(){var b=a.targetTouches[0].pageX-l,c=a.targetTouches[0].pageY-m;f.changeDir&&(Math.abs(b)<Math.abs(c)&&0>c?2!=f.direction&&(f.direction=0):Math.abs(b)>Math.abs(c)&&b>0?3!=f.direction&&(f.direction=1):Math.abs(b)<Math.abs(c)&&c>0?0!=f.direction&&(f.direction=2):1!=f.direction&&(f.direction=3)),n=null},30)}function c(){""==i?d.start():"fail"==i||"success"==i?(d.reset(),d.start()):"start"==i?d.pause():"pause"==i&&d["continue"]()}var d={},e=null,f=null,g=null,h=0,i="",j=document.getElementById("score"),k=document.getElementById("controller");d.init=function(){e=new Food,f=new Snack},d.start=function(){var a=this;i="start",k.innerHTML="暂停",e=null==e?new Food:e,f=null==f?new Snack:f,g=setTimeout(function b(){f.move()?(f.eat(e)&&(a.addScore(e.score),e=new Food),g=setTimeout(b,250-50*config.getSpeed())):a.fail()},200/config.getSpeed())},d.pause=function(){i="pause",k.innerHTML="继续",clearTimeout(g)},d["continue"]=function(){var a=this;i="start",k.innerHTML="暂停",g=setInterval(function(){f.move()?(f.eat(e)&&(a.addScore(e.score),e=new Food),g=setTimeout(action,250-50*config.getSpeed())):a.fail()},200/config.getSpeed())},d.fail=function(){i="fail",k.innerHTML="再来一局"},d.succ=function(){i="success",k.innerHTML="再来一局"},d.addScore=function(a){h+=a,j.innerHTML=h,h%10==0&&config.speedup()},d.reset=function(){h=0,j.innerHTML=h,e=null,f=null,config.resetSpeed(),config.context.clearRect(0,0,config.getWidth()*config.getSize(),config.getHeight()*config.getSize())};var l=null,m=null,n=null;document.body.addEventListener("keydown",a,!1),document.body.addEventListener("touchmove",b,!1),k.addEventListener("click",c,!1),k.addEventListener("tap",c,!1),window.game=d}(),Snack.prototype.move=function(){var a=config.getSize();switch(this.changeDir=!0,this.direction){case 0:this.head.y-=1;break;case 1:this.head.x+=1;break;case 2:this.head.y+=1;break;case 3:this.head.x-=1}if(this.crash())return!1;if(this.track.push({x:this.head.x,y:this.head.y}),config.context.fillStyle="#333",config.context.fillRect(this.head.x*a,this.head.y*a,a,a),this.snackLen<this.track.length){var b=this.track.shift();config.context.clearRect(b.x*a,b.y*a,a,a)}return!0},Snack.prototype.eat=function(a){var b=config.getSize();return this.head.x==a.x&&this.head.y==a.y?(this.snackLen++,config.context.fillStyle="#333",config.context.fillRect(this.head.x*b,this.head.y*b,b,b),!0):!1},Snack.prototype.crash=function(){if(this.head.x<0||this.head.x>config.getWidth())return!0;if(this.head.y<0||this.head.y>config.getHeight())return!0;for(var a=0;a<this.track.length;a++)if(this.track[a].x==this.head.x&&this.track[a].y==this.head.y)return!0;return!1};