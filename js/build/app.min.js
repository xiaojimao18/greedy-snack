/*! greedy-snack 1.0.0 2015-08-13 */
function Food(a,b){var c=config.size;this.score=a||1,this.time=b||-1,this.x=Math.floor(Math.random()*config.width),this.y=Math.floor(Math.random()*config.height),config.context.fillStyle="#3f51b5",config.context.fillRect(this.x*c,this.y*c,c,c)}var config={size:13,width:20,height:20,context:null};!function(){function a(a){switch(a.keyCode){case 38:snack.pushDirection(0);break;case 39:snack.pushDirection(1);break;case 40:snack.pushDirection(2);break;case 37:snack.pushDirection(3)}}function b(a){a.preventDefault(),null==f?(d=a.targetTouches[0].pageX,e=a.targetTouches[0].pageY):clearTimeout(f),f=setTimeout(function(){var b=a.targetTouches[0].pageX-d,c=a.targetTouches[0].pageY-e;Math.abs(b)<Math.abs(c)&&0>c?snack.pushDirection(0):Math.abs(b)>Math.abs(c)&&b>0?snack.pushDirection(1):Math.abs(b)<Math.abs(c)&&c>0?snack.pushDirection(2):snack.pushDirection(3),f=null},60)}function c(){var a=game.getStatus();""==a||"pause"==a?game.start():"fail"==a||"success"==a?(game.reset(),game.start()):"start"==a&&game.pause()}var d=null,e=null,f=null;document.body.addEventListener("keydown",a,!1),document.body.addEventListener("touchmove",b,!1),document.getElementById("controller").addEventListener("click",c,!1)}(),!function(){var a={},b=0,c=null,d="",e=null,f=document.getElementById("score"),g=document.getElementById("controller");a.init=function(){var a=document.getElementById("game-zone");return a.getContext?(config.context=a.getContext("2d"),snack.init(),void(c=new Food)):void alert("您的浏览器版本太低，请您使用更高级的浏览器来运行")},a.addScore=function(a){b+=a,f.innerHTML=b,b%10==0&&snack.speedUp()},a.start=function(){var a=this;d="start",g.innerHTML="暂停",e=setTimeout(function b(){return snack.move()?(snack.eat(c)&&(a.addScore(c.score),c=new Food),void(e=setTimeout(b,snack.getSpeed()))):void a.fail()},snack.getSpeed())},a.pause=function(){d="pause",g.innerHTML="继续",clearTimeout(e)},a.fail=function(){d="fail",g.innerHTML="再来一局"},a.succ=function(){d="success",g.innerHTML="再来一局"},a.reset=function(){b=0,f.innerHTML=b,config.context.clearRect(0,0,config.width*config.size,config.height*config.size),snack.reset(),c=new Food},a.getStatus=function(){return d},window.game=a}(),!function(){var a={},b=[],c=null,d=250,e=5,f=1,g=[],h=3;a.init=function(){for(var a=0;e>a;a++)b.push({x:a,y:0}),config.context.fillStyle="#333",config.context.fillRect(a*config.size,0,config.size,config.size);c={x:a-1,y:0}},a.reset=function(){b=[],d=250,e=5,f=1,g=[],this.init()},a.speedUp=function(){d>50&&(d-=50)},a.getSpeed=function(){return d},a.pushDirection=function(a){g.length<h&&g.push(a)},a.move=function(){for(var a=config.size;g.length>0;){var d=g.shift();if(d!=f&&2!=Math.abs(f-d)){f=d;break}}switch(f){case 0:c.y-=1;break;case 1:c.x+=1;break;case 2:c.y+=1;break;case 3:c.x-=1}if(this.crash())return!1;if(b.push({x:c.x,y:c.y}),config.context.fillStyle="#333",config.context.fillRect(c.x*a,c.y*a,a,a),e<b.length){var h=b.shift();config.context.clearRect(h.x*a,h.y*a,a,a)}return!0},a.eat=function(a){var b=config.size;return c.x==a.x&&c.y==a.y?(e++,config.context.fillStyle="#333",config.context.fillRect(c.x*b,c.y*b,b,b),!0):!1},a.onbody=function(a,c){for(var d=0;d<b.length;d++)if(b[d].x==a&&b[d].y==c)return!0;return!1},a.crash=function(){return c.x<0||c.x>config.width?!0:c.y<0||c.y>config.height?!0:this.onbody(c.x,c.y)},window.snack=a}();