/*! greedy-snack 1.0.0 2015-08-11 */
function Snack(){this.snackLen=5,this.direction=1,this.track=[],this.head=null,this.changeDir=!0;for(var a=0;a<this.snackLen;a++)config.context.fillStyle="#333",config.context.fillRect(a*config.getSize(),0,config.getSize(),config.getSize()),this.track.push({x:a,y:0});this.head={x:a-1,y:0}}function Food(a,b){var c=config.getSize();this.score=a||1,this.time=b||-1,this.x=Math.floor(Math.random()*config.getWidth()),this.y=Math.floor(Math.random()*config.getHeight()),config.context.fillStyle="#3f51b5",config.context.fillRect(this.x*c,this.y*c,c,c)}!function(){var a={},b=30,c=30,d=1,e=10;a.init=function(){var a=document.getElementById("game-zone");return a.getContext?void(this.context=a.getContext("2d")):void alert("您的浏览器版本太低，请您使用更高级的浏览器来运行")},a.speedup=function(){5>d&&d++},a.speeddown=function(){d>1&&d--},a.getSpeed=function(){return d},a.getWidth=function(){return b},a.getHeight=function(){return c},a.getSize=function(){return e},window.config=a}(),!function(){var a={},b=null,c=null,d=null,e=0,f="",g=document.getElementById("score"),h=document.getElementById("controller");a.init=function(){b=new Food,c=new Snack},a.start=function(){var a=this;f="start",h.innerHTML="暂停",b=null==b?new Food:b,c=null==c?new Snack:c,d=setTimeout(function e(){c.move()?(c.eat(b)&&(a.addScore(b.score),b=new Food),d=setTimeout(e,200/config.getSpeed())):a.fail()},200/config.getSpeed())},a.pause=function(){f="pause",h.innerHTML="继续",clearTimeout(d)},a["continue"]=function(){var a=this;f="start",h.innerHTML="暂停",d=setInterval(function(){c.move()?(c.eat(b)&&(a.addScore(b.score),b=new Food),d=setTimeout(action,200/config.getSpeed())):a.fail()},200/config.getSpeed())},a.fail=function(){f="fail",h.innerHTML="再来一局"},a.succ=function(){f="success",h.innerHTML="再来一局"},a.addScore=function(a){e+=a,g.innerHTML=e,e%10==0&&config.speedup()},a.reset=function(){e=0,g.innerHTML=e,b=null,c=null,config.context.clearRect(0,0,config.getWidth()*config.getSize(),config.getHeight()*config.getSize())},document.body.onkeydown=function(a){if(null!==c&&c.changeDir)switch(c.changeDir=!1,a.keyCode){case 38:2!=c.direction&&(c.direction=0);break;case 39:3!=c.direction&&(c.direction=1);break;case 40:0!=c.direction&&(c.direction=2);break;case 37:1!=c.direction&&(c.direction=3)}},h.onclick=function(){""==f?a.start():"fail"==f||"success"==f?(a.reset(),a.start()):"start"==f?a.pause():"pause"==f&&a["continue"]()},window.game=a}(),Snack.prototype.move=function(){var a=config.getSize();switch(this.changeDir=!0,this.direction){case 0:this.head.y-=1;break;case 1:this.head.x+=1;break;case 2:this.head.y+=1;break;case 3:this.head.x-=1}if(this.crash())return!1;if(this.track.push({x:this.head.x,y:this.head.y}),config.context.fillStyle="#333",config.context.fillRect(this.head.x*a,this.head.y*a,a,a),this.snackLen<this.track.length){var b=this.track.shift();config.context.clearRect(b.x*a,b.y*a,a,a)}return!0},Snack.prototype.eat=function(a){var b=config.getSize();return this.head.x==a.x&&this.head.y==a.y?(this.snackLen++,config.context.fillStyle="#333",config.context.fillRect(this.head.x*b,this.head.y*b,b,b),!0):!1},Snack.prototype.crash=function(){if(this.head.x<0||this.head.x>config.getWidth())return!0;if(this.head.y<0||this.head.y>config.getHeight())return!0;for(var a=0;a<this.track.length;a++)if(this.track[a].x==this.head.x&&this.track[a].y==this.head.y)return!0;return!1};